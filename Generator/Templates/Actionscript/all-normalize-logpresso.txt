if {exists lines whose (it contains "Scan error: ") of files "logpresso.log" of folders (parameter "DataDir")}
	delete "__appendfile"
	delete "{parameter "DataDir"}/{(parameter "LogpressoMode") as lowercase}error.out"
	
	appendfile {concatenations "%0a" of unique values of (it as string) of (following text of first "Scan error: " of it) of lines whose (it contains "Scan error: ") of files "logpresso.log" of folder (parameter "DataDir")}
	
	move __appendfile "{parameter "DataDir"}/{(parameter "LogpressoMode") as lowercase}error.out"
endif

if {exists lines whose (it contains "%22VULNERABLE%22" and not (it contains "%22FIXED%22")) of files "logpresso-results.csv" of folders (parameter "DataDir")}
	delete "__appendfile"
	delete "{parameter "DataDir"}/result.out"
	
	appendfile {concatenations "%0a" of unique values of (it as string) of ((concatenations "" of substrings separated by "%22" of tuple string item 3 of it, concatenations "" of substrings separated by "%22" of tuple string item 1 of it) of concatenations ", " of substrings separated by "," of it) of lines whose (it contains "%22VULNERABLE%22" and not (it contains "%22FIXED%22")) of file "logpresso-results.csv" of folder (parameter "DataDir")}
	
	copy __appendfile "{parameter "DataDir"}/result.out"

	// In remediation mode these are the ones that were not fixed for one reason or another
	if {(parameter "LogpressoMode") = "Remediation"}
		move __appendfile "{parameter "DataDir"}/notfixed.out"
	endif
endif

if {exists lines whose (it contains "%22MITIGATED%22") of files "logpresso-results.csv" of folders (parameter "DataDir")}
	delete "__appendfile"
	delete "{parameter "DataDir"}/mitigated.out"
	
	appendfile {concatenations "%0a" of unique values of (it as string) of ((concatenations "" of substrings separated by "%22" of tuple string item 3 of it, concatenations "" of substrings separated by "%22" of tuple string item 1 of it) of concatenations ", " of substrings separated by "," of it) of lines whose (it contains "%22MITIGATED%22") of file "logpresso-results.csv" of folder (parameter "DataDir")}
	
	move __appendfile "{parameter "DataDir"}/mitigated.out"
endif

if {exists lines whose (it contains "%22FIXED%22") of files "logpresso-results.csv" of folders (parameter "DataDir")}
	delete "__appendfile"
	delete "{parameter "DataDir"}/fixed.out"
	
	appendfile {concatenations "%0a" of unique values of (it as string) of ((concatenations "" of substrings separated by "%22" of tuple string item 3 of it, concatenations "" of substrings separated by "%22" of tuple string item 1 of it) of concatenations ", " of substrings separated by "," of it) of lines whose (it contains "%22FIXED%22") of file "logpresso-results.csv" of folder (parameter "DataDir")}
	
	move __appendfile "{parameter "DataDir"}/fixed.out"
endif