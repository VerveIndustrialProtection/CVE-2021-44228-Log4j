delete __createfile

createfile until _end_
#!/bin/bash

# Make sure our result file exist
touch "{parameter "DataDir"}/filedescriptor.out"

pids=$(ps -ef | awk '{{print $2}')

# Iterate through all of the PIDs
IFS=$' ' readarray -t PIDS <<< "$pids"
for pid in "${{PIDS[@]}"; do
	echo "Processing: $pid"
	# We avoid a dependency on lsof by interogating the fd directly
	if [[ -d /proc/$pid/fd ]]; then
		# the fd is a directory with links between file descriptor ids and the file on the filesystem
		# find all file descriptors that point to a log4j jar and write them to our results
		ls -l /proc/$pid/fd | {parameter "Query"} >> "{parameter "DataDir"}/filedescriptor.out"
	fi
done
_end_

delete run.sh
move __createfile run.sh

delete __appendfile
appendfile /bin/bash run.sh > "{parameter "DataDir"}/filedescriptor.log"

delete runandlog.sh
move __appendfile runandlog.sh

delete "{parameter "DataDir"}/filedescriptor.out"
delete "{parameter "DataDir"}/filedescriptor.log"

wait /bin/bash runandlog.sh