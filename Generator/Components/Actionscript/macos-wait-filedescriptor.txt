delete __createfile

createfile until _end_
#!/bin/bash

# Make sure our result file exist
touch "{parameter "DataDir"}/filedescriptors.out"

# find all file descriptors that point to a log4j jar and write them to our results
lsof -p $(ps -ef | awk '{{print $2}' | awk 'NR>1' | tr '\012' ,) | {parameter "Query"} >> "{parameter "DataDir"}/filedescriptors.out"
_end_
	
delete run.sh
move __createfile run.sh

delete __appendfile
appendfile /bin/bash run.sh > "{parameter "DataDir"}/filedescriptors.log"

delete runandlog.sh
move __appendfile runandlog.sh

delete "{parameter "DataDir"}/openhandles.out"
delete "{parameter "DataDir"}/openhandles.log"

wait /bin/bash runandlog.sh
